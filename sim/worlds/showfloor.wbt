#VRML_SIM R2023b utf8
WorldInfo {
  title "ROS2 AMR Showfloor"
  info [
    "A demo showroom environment for autonomous mobile robot navigation"
    "Features obstacles, fiducials, and navigation challenges"
  ]
  basicTimeStep 16
  physicsDisableTime 0
  coordinateSystem "ENU"
  contactProperties [
    ContactProperties {
      material1 "default"
      material2 "ground"
      coulombFriction [
        1
      ]
      frictionRotation [
        0 0 0
      ]
      bounce 0
      forceDependentSlip [
        0 0 0
      ]
    }
    ContactProperties {
      material1 "default"
      material2 "obstacle"
      coulombFriction [
        0.8
      ]
      frictionRotation [
        0 0 0
      ]
      bounce 0
      forceDependentSlip [
        0 0 0
      ]
    }
  ]
}
Viewpoint {
  orientation 0.322885 -0.796537 -0.511506 4.14159
  position 4.5 3.2 4.5
  follow "diffbot"
}
TexturedBackground {
}
TexturedBackgroundLight {
  illumination 0.7
  rotation 0.57735 0.57735 0.57735 2.094395
}
RectangleArena {
  rotation 1 0 0 -1.5708
  size 10 10
  tileSize 0.5
  appearance PBRAppearance {
    baseColorMap ImageTexture {
      url [
        "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/default/worlds/textures/checkered_parquet.jpg"
      ]
    }
    roughness 0.7
    metalness 0
  }
}
Robot {
  translation 0 0 0.05
  children [
    DEF DIFFBOT_SHAPE Group {
      children [
        Transform {
          translation 0 0 0.02
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0.2 0.2 0.8
                roughness 0.3
                metalness 0.8
              }
              geometry Cylinder {
                height 0.04
                radius 0.08
              }
            }
          ]
        }
        Transform {
          translation 0 0 0.06
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0.8 0.2 0.2
                roughness 0.3
                metalness 0.8
              }
              geometry Cylinder {
                height 0.02
                radius 0.06
              }
            }
          ]
        }
        Transform {
          translation 0.06 0 0.06
          rotation 0 1 0 1.5708
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0.2 0.8 0.2
                roughness 0.3
                metalness 0.8
              }
              geometry Cylinder {
                height 0.12
                radius 0.01
              }
            }
          ]
        }
      ]
    }
    HingeJoint {
      jointParameters HingeJointParameters {
        anchor 0.05 0.06 0
        axis 0 1 0
      }
      device [
        RotationalMotor {
          name "left wheel motor"
          maxVelocity 12.26
        }
        PositionSensor {
          name "left wheel sensor"
        }
      ]
      endPoint Solid {
        translation 0.05 0.06 0
        rotation 1 0 0 1.5708
        children [
          DEF WHEEL Shape {
            appearance PBRAppearance {
              baseColor 0.2 0.2 0.2
              roughness 0.3
              metalness 0.8
            }
            geometry Cylinder {
              height 0.02
              radius 0.025
            }
          }
        ]
        name "left wheel"
        physics Physics {
          density -1
          mass 0.4
        }
      ]
    }
    HingeJoint {
      jointParameters HingeJointParameters {
        anchor 0.05 -0.06 0
        axis 0 1 0
      }
      device [
        RotationalMotor {
          name "right wheel motor"
          maxVelocity 12.26
        }
        PositionSensor {
          name "right wheel sensor"
        }
      ]
      endPoint Solid {
        translation 0.05 -0.06 0
        rotation 1 0 0 1.5708
        children [
          USE WHEEL
        ]
        name "right wheel"
        physics Physics {
          density -1
          mass 0.4
        }
      ]
    }
    DEF DS_RIGHT DistanceSensor {
      translation 0.1 -0.03 0.05
      rotation 0 0 1 -1.5708
      name "ds_right"
      lookupTable [
        0 1024 0
        0.05 1024 0
        0.1 0 0
        1.0 0 0
      ]
      type "infra-red"
    }
    DEF DS_LEFT DistanceSensor {
      translation 0.1 0.03 0.05
      rotation 0 0 1 -1.5708
      name "ds_left"
      lookupTable [
        0 1024 0
        0.05 1024 0
        0.1 0 0
        1.0 0 0
      ]
      type "infra-red"
    }
    DEF CAMERA Camera {
      translation 0.08 0 0.06
      rotation 0 1 0 1.5708
      name "camera"
      width 320
      height 240
      fieldOfView 1.047
    }
    DEF LIDAR Lidar {
      translation 0 0 0.08
      rotation 0 0 1 0
      name "lidar"
      horizontalResolution 360
      numberOfLayers 1
      minRange 0.05
      maxRange 12
      fieldOfView 6.28318
      verticalFieldOfView 0.0873
      type "rotating"
    }
  ]
  name "diffbot"
  physics Physics {
    density -1
    mass 1
    centerOfMass [
      0 0 0
    ]
    inertiaMatrix [
      0.01 0.01 0.01
      0 0 0
    ]
  }
  controller "webots_ros2_driver"
  controllerArgs ["--ros-args", "--params-file", "/ros2_ws/src/amr_bringup/params/robot_params.yaml"]
}

# Showroom obstacles and features
Solid {
  translation 2 2 0.5
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.8 0.4 0.2
        roughness 0.7
        metalness 0.3
      }
      geometry Box {
        size 0.8 0.8 1
      }
    }
  ]
  name "obstacle_1"
  contactMaterial "obstacle"
  boundingObject Box {
    size 0.8 0.8 1
  }
  physics Physics {
  }
}

Solid {
  translation -2 -1 0.25
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.2 0.6 0.8
        roughness 0.7
        metalness 0.3
      }
      geometry Box {
        size 1.2 0.4 0.5
      }
    }
  ]
  name "obstacle_2"
  contactMaterial "obstacle"
  boundingObject Box {
    size 1.2 0.4 0.5
  }
  physics Physics {
  }
}

Solid {
  translation 3 -2 0.3
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.6 0.8 0.2
        roughness 0.7
        metalness 0.3
      }
      geometry Cylinder {
        height 0.6
        radius 0.4
      }
    }
  ]
  name "obstacle_3"
  contactMaterial "obstacle"
  boundingObject Cylinder {
    height 0.6
    radius 0.4
  }
  physics Physics {
  }
}

# Fiducial markers (AprilTags/ArUco) - represented as simple textured planes
Solid {
  translation 4.5 0 1.5
  rotation 0 0 1 -1.5708
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 1 1
        roughness 0.3
        metalness 0.1
        baseColorMap ImageTexture {
          url [
            "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iYmxhY2siLz4KICA8cmVjdCB4PSI0MCIgeT0iNDAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0id2hpdGUiLz4KICA8cmVjdCB4PSIxMjAiIHk9IjQwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IndoaXRlIi8+CiAgPHJlY3QgeD0iNDAiIHk9IjEyMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSJ3aGl0ZSIvPgogIDxyZWN0IHg9IjEyMCIgeT0iMTIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo="
          ]
        }
      }
      geometry Plane {
        size 0.2 0.2
      }
    }
  ]
  name "fiducial_1"
  boundingObject Plane {
    size 0.2 0.2
  }
  physics Physics {
  }
}

Solid {
  translation -4.5 2 1.2
  rotation 0 0 1 1.5708
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 1 1
        roughness 0.3
        metalness 0.1
        baseColorMap ImageTexture {
          url [
            "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iYmxhY2siLz4KICA8cmVjdCB4PSI0MCIgeT0iNDAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0id2hpdGUiLz4KICA8cmVjdCB4PSIxMjAiIHk9IjQwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IndoaXRlIi8+CiAgPHJlY3QgeD0iNDAiIHk9IjEyMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSJ3aGl0ZSIvPgogIDxyZWN0IHg9IjEyMCIgeT0iMTIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo="
          ]
        }
      }
      geometry Plane {
        size 0.2 0.2
      }
    }
  ]
  name "fiducial_2"
  boundingObject Plane {
    size 0.2 0.2
  }
  physics Physics {
  }
}

Solid {
  translation 0 -4.5 1.8
  rotation 0 0 1 0
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 1 1
        roughness 0.3
        metalness 0.1
        baseColorMap ImageTexture {
          url [
            "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iYmxhY2siLz4KICA8cmVjdCB4PSI0MCIgeT0iNDAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0id2hpdGUiLz4KICA8cmVjdCB4PSIxMjAiIHk9IjQwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IndoaXRlIi8+CiAgPHJlY3QgeD0iNDAiIHk9IjEyMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSJ3aGl0ZSIvPgogIDxyZWN0IHg9IjEyMCIgeT0iMTIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo="
          ]
        }
      }
      geometry Plane {
        size 0.2 0.2
      }
    }
  ]
  name "fiducial_3"
  boundingObject Plane {
    size 0.2 0.2
  }
  physics Physics {
  }
}

